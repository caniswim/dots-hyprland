#!/bin/bash
# Generated by apply-we-wallpaper.sh
# Restores Wallpaper Engine wallpaper after reboot

WORKSHOP_BASE="/mnt/Games/SteamLibrary/steamapps/workshop/content/431960"
ASSETS_DIR="/mnt/Games/SteamLibrary/steamapps/common/wallpaper_engine/assets"
SHELL_CONFIG_FILE="${XDG_CONFIG_HOME:-$HOME/.config}/illogical-impulse/config.json"

# Read workshop ID from config
if [ ! -f "$SHELL_CONFIG_FILE" ]; then
    echo "Config file not found: $SHELL_CONFIG_FILE"
    exit 1
fi

IS_ACTIVE=$(jq -r '.background.wallpaperEngine.isActive // false' "$SHELL_CONFIG_FILE")
if [ "$IS_ACTIVE" != "true" ]; then
    echo "WE wallpaper not active"
    exit 0
fi

WORKSHOP_ID=$(jq -r '.background.wallpaperEngine.workshopId // ""' "$SHELL_CONFIG_FILE")
if [ -z "$WORKSHOP_ID" ]; then
    echo "No workshop ID in config"
    exit 0
fi

WORKSHOP_PATH="$WORKSHOP_BASE/$WORKSHOP_ID"

if [ ! -d "$WORKSHOP_PATH" ]; then
    echo "Workshop directory not found: $WORKSHOP_PATH"
    exit 1
fi

# Get monitors
MONITORS=$(hyprctl monitors -j | jq -r '.[] | .name')

# Apply wallpaper
CMD="linux-wallpaperengine"
CMD="$CMD --assets-dir \"$ASSETS_DIR\""
CMD="$CMD --fps 60"
CMD="$CMD --silent"

for monitor in $MONITORS; do
    CMD="$CMD --screen-root $monitor"
done

CMD="$CMD \"$WORKSHOP_PATH\""

eval "$CMD" &

echo "Wallpaper Engine wallpaper restored: $WORKSHOP_ID"
